<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<title>beyond Admin后台</title>

<meta name="description" content="Dashboard">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--Basic Styles-->
<link href="__ADMIN__/style/bootstrap.css" rel="stylesheet">
<link href="__ADMIN__/style/font-awesome.css" rel="stylesheet">
<link href="__ADMIN__/style/weather-icons.css" rel="stylesheet">

<!--Beyond styles-->
<link id="beyond-link" href="__ADMIN__/style/beyond.css" rel="stylesheet" type="text/css">
<link href="__ADMIN__/style/demo.css" rel="stylesheet">
<link href="__ADMIN__/style/typicons.css" rel="stylesheet">
<link href="__ADMIN__/style/animate.css" rel="stylesheet">

</head>
<body>
<!-- 头部 -->
{include file='commons/header'}

<!-- /头部 -->

<div class="main-container container-fluid">
<div class="page-container">
<!-- Page Sidebar -->
{include file='commons/left'}
<!-- /Page Sidebar -->
<!-- Page Content -->
<div class="page-content">
<!-- Page Breadcrumb -->
<div class="page-breadcrumbs">
<ul class="breadcrumb">
            <li>
<a href="#">系统</a>
</li>
            <li class="active">模型管理</li>
            </ul>
</div>
<!-- /Page Breadcrumb -->

<!-- Page Body -->
<div class="page-body">

<button type="button" tooltip="添加用户" class="btn btn-sm btn-azure btn-addon" onClick="javascript:window.location.href = '{:url("tpmodel/add")}'"> <i class="fa fa-plus"></i> Add
</button>
<div class="row">
<div class="col-lg-12 col-sm-12 col-xs-12">
<div class="widget">
<div class="widget-body">
<div class="flip-scroll">
    <form action="" method='post'>
<table class="table table-bordered table-hover">
<thead class="">
<tr>
	<th class="text-center">模型ID</th>
    <th class="text-center">模型名称</th>
    <th class="text-center">附加表名</th>
    <th class="text-center">启用状态</th>
    <th class="text-center" width='20%'>操作</th>
</tr>
</thead>
<tbody>
   
{volist name='modelRes' id='model'}  
<!-- 这里的id用作状态   -->                    
    <tr id={$model['id']}>
    	<td align="center">{$model['id']}</td>
        <td align="center">{$model['model_name']}</td>
        <td align="center">{$prefix}{$model['table_name']}</td>
         <td align="center">{if $model['status']}<a class="btn btn-success btnstatus">启用</a>{else/}<a class="btn btn-danger btnstatus">禁用</a>{/if}</td>
        <td align="center">
            <a href="{:url('tpmodel/edit',array('modelid'=>$model.id))}" class="btn btn-primary btn-sm shiny">
                <i class="fa fa-edit"></i> 编辑
            </a>
            <!-- 这里的属性用作删除模型 -->
            <a href="#" onClick="ajaxdel(this);" class="btn btn-danger btn-sm shiny" id="{$model['id']}" table_name="{$prefix}{$model['table_name']}">
                <i class="fa fa-trash-o"></i> 删除
            </a>
        </td>
    </tr>
   {/volist}                  
    </tbody>
</table>




</form>

</div>
<div>

<div class="div" style='margin-top:20px;'>

</div>
      
        </div>
</div>
</div>
</div>
</div>
</div>
<!-- /Page Body -->
</div>
<!-- /Page Content -->
</div>  
</div>

<!--Basic Scripts-->
<script src="__ADMIN__/style/jquery_002.js"></script>
<script src="__ADMIN__/style/bootstrap.js"></script>
<script src="__ADMIN__/style/jquery.js"></script>
<!--Beyond Scripts-->
<script src="__ADMIN__/style/beyond.js"></script>







<link rel='stylesheet' href="__ADMIN__/layui/css/layui.css">
<script src="__ADMIN__/layui/layui.js"></script>
<script>
$(function(){
	$(".btnstatus").bind('click',function(){
		var $the=$(this).index();
		var id=$(this).parents('tr').attr('id');

		$.ajax({
			type:'get',
			dataType:'json',
			async:false,
			url:'/admin/tpmodel/changestatus/modelid/'+id,
			success:function(data){
var $that=$("tr[id="+id+"]").find('.btnstatus');
				if(data==1){
					$that.text('禁用');
					$that.removeClass('btn-success').addClass('btn-danger');
					
				}else if(data==0){
					$that.text('启用');
				$that.removeClass('btn-danger').addClass('btn-success');
				
				}
			}
		})
	})

})


layui.use(['layer', 'form'], function(){
  var layer = layui.layer,form = layui.form;


  // layer.confirm('确定要删除该模型吗?');
  // layer.msg('确定要删除该模型吗?');
});

//ajax删除模型
	function ajaxdel(o){
		// alert('您好啊');

		layer.confirm('确定要删除该模型吗?', {icon: 3, title:'提示'}, function(index){
		var id=$(o).attr('id');
		var table_name=$(o).attr('table_name');
		$.ajax({
			type:'get',
			dataType:'json',
			async:false,
			url:"/admin/tpmodel/ajaxdel/table_name/"+table_name+"/id/"+id,
			success:function(data){  

				if(data==1){

					layer.msg('删除模型成功!',{icon:1});
					$(o).parents('tr').hide();
				}else{
					layer.msg('删除模型失败!',{icon:1});
				}
			}
		})
	layer.close(index);
});
		
	








	}
</script>


</body></html>